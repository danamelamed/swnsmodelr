---
title: "Vignette"
author: "Dana Melamed"
date: "April 30, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = 'F:\\Packages\\swnsmodelr')
#install.packages('randomcoloR')
library(swnsmodelr)
```

## Selecting Rasters as Inputs

### Constant Rasters
Rasters of physical properties of the environment that are constant through time are referred to as "constant rasters" in the package. Examples of these rasters, that are provided as extra data, are the elevation, aspect, slope, proximity to coast line, easting and northing values of the region. Since the values from these rasters do not change over time, they only need to be extracted to the weather station points once. In this section is an overview of how to select and manipulate these rasters.

#### Bring Constant Rasters into R Environment

Throughout the modelling workflow provided in the swnsmodelr package, the constant rasters should be in the form of raster objects in a list. Rasters have been provided in the swnsmodelr project. Selecting rasters from the project folder and storing them as a list of raster objects can be done with the following code:
```{r}
# See list of rasters in Rasters project folder


# Store names of rasters from list
rasters_dir <- file.path('D:','data','rasters','input_rasters')
rasters_names_list <- c("dem","tpi300m",'tpi2000m',"asp","east","north","ptoc","slp")
resolutions <- c('20m','100m','200m','700m','1000m')

all_rasters <-  file.path(rasters_dir,paste0(as.list(outer(rasters_names_list,resolutions,paste0)),'.tif'))

rasters_list <- list()
c <- 1
for(raster in all_rasters){
  try({rasters_list[[c]] <- raster(raster)
       c <- c+1
       }) 
}

```



```{r}
stations_df <- extract_constant_raster_values(swns_stations_df, rasters_list)

```  



#### Bring Temporal Rasters into R Environment
This stage requires two steps. In the first step, using `swnsmodelr::make_temporal_rasters_df()` the paths for all the temporal rasters are stored in a dataframe, with their corresponding date. This data frame is called the temporal rasters dataframe. In the second step, the temporal rasters dataframe is used to point to rasters, and extract their values to the `stations_df`. Here, the temporal rasters dataframe is called `solar_irradiance_rasters_df`.

```{r}
resolutions = c('20m','100m','200m','700m','1000m')
for(res in resolutions){
  print(res)
solar_irradiance_rasters_df <- make_temporal_raster_df(
  in_folder = paste0("D:\\GOES\\",res),
  start_date = ymd('2012-01-01'),
  end_date   = ymd('2017-12-31'),
  date_chars = c(16,-5),
  date_format = "%Y_%j",
  extension = ".tif")
stations_df <- extract_temporal_raster_values(solar_irradiance_rasters_df,
                                              stations_df,
                                              paste0('solar',res))
}
```

#### Investigate Potential Usefulness of Constant Rasters

The first thing to investigatea about the usefulness of a constant raster, is the variation among weather stations. Obviously, if only small amount of the raster values are represented at stations, the model will extrapolating to model temperature over the region, rather that interpolating. 

